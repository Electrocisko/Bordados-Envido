<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Productos</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
  </head>
  <body class="container">
    <h1>Lista de productos</h1>

    <table class="table">
      <thead>
        <tr>
          <th scope="col">id</th>
          <th scope="col">Modelo</th>
          <th scope="col">Precio</th>
          <th scope="col">Imagen</th>
          <th scope="col">Acciones</th>
          <th scope="col"></th>
        </tr>
      </thead>
      <tbody>
        <% data.forEach(element => { %>
        <tr>
          <th scope="row"><%= element._id %></th>
          <td><%= element.modelo %></td>
          <td>$<%= element.precio %></td>
          <td>
            <img
              src="./images/<%= element.image %>"
              alt="Logo"
              style="height: 50px"
            />
          </td>
          <td>
            <button
            onclick="updatedItem('<%= element._id %>')"
              class="btn btn-warning btn-sm modified"
              name="<%= element._id %>"
            >
              Modificar
            </button>
          </td>
          <td>
            <button
              onclick="deleteItem('<%= element._id %>','<%= token %>')"
              class="btn btn-danger btn-sm delete"
              name="<%= element._id %>"
            >
              Eliminar
            </button>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
    <script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>

    <script>
      // Function que hace fetch y manda el id y token
      function deleteItem(id, token) {
        let url = `http://localhost:8080/api/eliminar/${id}`;

        fetch(url, {
          method: "DELETE",
          headers: {
            Authorization: token,
          },
        })
          .then((response) => response.json())
          .then((data) => {
            if (data.status === "error") {
              Swal.fire(data.message);
            }
            if (data.status === "success") {
              Swal.fire("Borrado!", "El producto fue eliminado.", "success");
            }
          })
          .then(location.reload())
          .catch((error) => console.log(error));
      }
    //funcion que me manda al formulario con el id en params
    function updatedItem(id) {
      window.location.href=`/modificar/${id}`
    }
    </script>

  </body>
</html>
